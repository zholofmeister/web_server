这个是我写的toy版本的webserver，因为做了这个toy发现c++好难，所以权当了解一下webserver在干嘛吧

![f6547b90f1b9eb38c1b3bf1fdfd8630](https://github.com/zholofmeister/web_server/assets/49775592/8a01fd3b-f738-4e84-831c-0011dbba1c9e)


服务器的模块由线程池，定时器，主从状态机，以及数据库连接这四个部分组成。

线程池模块主要由可动态扩容的线程数组，请求队列，锁和信号量组成，服务器预先会创建一定数量的工作线程存在数组中，用户发出的请求会先存入请求队列中，利用信号量唤醒工作线程，并从队列中取出请求并处理，此外在取出请求时，需要对请求队列加锁，目的是避免两个线程取出同一个任务而导致的线程安全问题。

定时器模块主要由双向链表存储的按时间升序排列的定时器列表组成，利用Linux系统调用alarm()函数实现周期更新定时器列表，删除超时的定时器，同时服务器关闭对应的与客户端进行通信的socket，释放与对应的客户端的连接。此外，创建管道用来向主线程传递SIGALRM信号，将管道读事件注册进epoll监听数组中，目的是使信号的达到不会中断主线程的执行过程，实现了统一事件源，提高了效率。

主从状态机模块处理客户端发来的HTTP请求报文，从状态机驱动主状态机，主状态机调用从状态机，从状态机通过报文中的\r\n将其分割成各个部分，主状态机负责对分割出来的该部分的报文的内容进行解析，从而判断出用户所请求的资源，从服务器中获取到那个资源，利用IO向量机制生成HTTP响应报文，最后返回给客户端。

数据库连接模块使用Redis来存储账号密码和投票信息，使用<hiredis.h>这个C语言库里面的函数，对数据库修改操作进行封装。另外，由于前端需要JSON格式的数据进行显示，所以可以直接在封装的数据库类里对查询得到的数据进行处理，将他转换为JSON格式。

服务器实现的功能方面，通过上述封装的各个模块，实现了登录注册，投票系统，多人在线聊天室，以及服务器日志这些功能，前端使用了jQuery的Ajax方法对数据进行实时显示，后端通过主从状态机解析用户的请求，并返回给用户请求的资源。

压力测试方面，利用Web Bench这个软件对我写的服务器程序进行压力测试，在长时间的压力测试下没有出现异常情况导致服务器终止，在本地可以达到1万以上的QPS，传输速度为20兆字节每秒，上传至云服务器后，利用公网IP即可进行访问，压力测试结果显示可以达到100以上的QPS，传输速度为10千字节每秒。
